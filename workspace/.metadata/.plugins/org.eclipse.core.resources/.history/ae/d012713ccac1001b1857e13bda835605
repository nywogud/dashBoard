package com.jhl.dashBoard.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.jhl.dashBoard.chart.CountNumAttem;
import com.jhl.dashBoard.chart.NumAttem;
import com.jhl.dashBoard.model.DataModel;
import com.jhl.dashBoard.service.DataService;


@CrossOrigin
@Controller
public class homeController {
	
	@Autowired
	DataService dataService;
	
	@RequestMapping("/")
	public String home(Model model) throws Exception {
		
		//1번 차트를 생성하는 로직
		//각 칼럼의 인증 수단 별 시도 횟수를 반환하는 서비스 객체(리스트 타입으로 반환) 
		List<DataModel> result1List =  dataService.getNumAttem();
		
		//자바스크립트 소스를 만들어 주는 클래스 객체 생성
		NumAttem numAttem = new NumAttem();
		
		//자바스크립트 소스를 만들어 주는 함수. 파라미터는 각 인증 수단과 시도 횟수를 저장하고 있는 데이터모델 타입의 리스트
		String scriptString = numAttem.resultHtml(result1List);
		
		//모델 객체에 담아 뷰에 전달.
		model.addAttribute("script1String", scriptString);
		
		//2번 차트를 생성하는 로직(시도횟수 분포 확인)
		List<DataModel> result2List = dataService.getConuntNumAttem();
		
		CountNumAttem countNumAttem = new CountNumAttem();
		
		String script2String = countNumAttem.countNumAttem(result2List);
		
		model.addAttribute("script2String", script2String);
		
		//표 차트 내용 뷰에 전달하는 코드
		
		List<DataModel> numAttemWithRowNum = dataService.getNumAttemWithRowNum();
		
		model.addAttribute("numAttemWithRowNum", numAttemWithRowNum);
		
		return "home";
	}
	
	@RequestMapping(value = "/sucResultNum", method = RequestMethod.POST)
	@ResponseBody
	public String sucResultNum() {
		return "반환값";
	}
}
